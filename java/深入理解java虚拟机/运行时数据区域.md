# 运行时数据区域

> 整体概述

java对于内存的管理整体上可以划分为共享内存和私有内存

共享内存很明显是为了管理一些大家都可以调用的信息

私有内存用来在线程内来分配,管理线程需要的信息

这时候共享内存对于值和方法分开管理

值,这里主要说对象,对于对象的管理几乎都在堆里

对于方法可能用到的,一些共享的,非对象的信息做管理,比如静态变量,常量池,类信息,代码缓存等等,杂货铺了属于是

对于私有内存而言

一个方法开始调用开始就会创建一份内存丢到一个集中区域去管理

也就是创建一个栈帧去放入虚拟机栈中去管理

## java虚拟机运行时数据区

如图

![](\pic\java虚拟机运行时方法区.png)

图:1-1

注: 其中白色部分是线程私有的

## 运行时数据区

### 线程私有

#### 程序计数器

* 是什么

  ~~~text
  是一块内存空间,当前线程所执行的字节码的行号指示器
  ~~~

  

* 为什么

  ~~~text
  java线程是通过线程轮流切换、分配处理器时间来实现的
  
  那么切换线程的时候需要一个计数器来指明执行到哪一行字节码了
  ~~~

* 怎么做

  ~~~text
  执行到一行字节码指令，该线程内程序计数器+1
  ~~~

  

#### 虚拟机栈

* 是什么

  ~~~text
  一个线程内存模型
  描述了java方法执行的线程模型	
  ~~~

* 为什么

  ~~~text
  线程运行的时候需要一份儿独立的内存来存贮方法需要用到的信息,且与其他线程隔离开
  ~~~

  

* 怎么做

  ~~~text
  每个方法执行的时候
  虚拟机会同步创建一个栈帧
  方法从被调用到调用结束
  就是栈帧从入栈到出栈的过程
  ~~~

* 包含了
  * 栈帧
    * 局部变量表(内部数据以局部变量槽Slot的形式存储)
      * java基本类型
      * 引用类型对应地址
    * 操作数栈
    * 动态连接
    * 方法出口

#### 本地方法栈

* 是什么

  ~~~text
  本地的native方法执行需要用到的内存空间
  在hotSpot虚拟机中二者合一通称为栈
  ~~~

### 线程共享

#### 方法区

* 是什么

  ~~~text
  线程共享的内存区域
  ~~~

* 为什么

  ~~~text
  因为要存储一些共享的静态数据,常量,类信息等等
  ~~~

  

* 怎么做

  ~~~text
  Hotspot虚拟机使用永久代来实现的方法区
  存储了被虚拟机加载的
  类型信息
  静态变量
  常量(包含了字符串常量池)
  即时编译后的代码缓存等
  ~~~

  

* 历史变更

  * 1.6之前是用永久代来实现的
  * 1.6逐步开始了采用本地内存取代永久代的计划
  * 1.7开始把对应的静态变量和常量池转移到了堆
  * 1.8开始彻底用内存元空间来取代永久代

#### 堆

* 是什么

  ~~~text
  所有线程共享的一份儿内存区域
  虚拟机启动时创建
  是垃圾收集器管理的内存区域
  ~~~

* 为什么

  ~~~text
  内存中管理对象
  ~~~

* 怎么做

  ~~~text
  从分配内存的角度看
  可以分配成多个私有的内存缓冲区TLAB
  但是不管如何,不会改变堆内数据的共享性质
  ~~~

* 可拓展说明

  * 大小要求
    * 可拓展,取决于参数
      * -xms
      * -xmx
    * 不可拓展
  * 连续性要求
    * 对于对象等,没有连续性要求
    * 对于数组等,有连续性要求

  

  ---

  

  

